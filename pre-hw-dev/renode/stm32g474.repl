// STM32G474 Platform Description for Renode
// JEZGRO Development Simulation

cpu: CPU.CortexM @ sysbus
    cpuType: "cortex-m4f"
    nvic: nvic

nvic: IRQControllers.NVIC @ sysbus 0xE000E000
    priorityMask: 0xF0
    systickFrequency: 170000000
    -> cpu@0

// Memory regions
flash: Memory.MappedMemory @ sysbus 0x08000000
    size: 0x80000  // 512 KB

sram1: Memory.MappedMemory @ sysbus 0x20000000
    size: 0x14000  // 80 KB

sram2: Memory.MappedMemory @ sysbus 0x20014000
    size: 0x4000   // 16 KB

ccmram: Memory.MappedMemory @ sysbus 0x10000000
    size: 0x8000   // 32 KB

// Peripherals
usart1: UART.STM32_UART @ sysbus 0x40013800
    -> nvic@37

usart2: UART.STM32_UART @ sysbus 0x40004400
    -> nvic@38

lpuart1: UART.STM32_UART @ sysbus 0x40008000
    -> nvic@91

// Timers
timer2: Timers.STM32_Timer @ sysbus 0x40000000
    -> nvic@28
    frequency: 170000000
    initialLimit: 0xFFFFFFFF

timer6: Timers.STM32_Timer @ sysbus 0x40001000
    -> nvic@54
    frequency: 170000000

systick: Timers.CortexM_SysTick @ sysbus 0xE000E010
    frequency: 170000000

// GPIO (basic model)
gpioA: GPIOPort.STM32_GPIOPort @ sysbus 0x48000000
    numberOfPins: 16
    [0-15] -> gpioManager@[0-15]

gpioB: GPIOPort.STM32_GPIOPort @ sysbus 0x48000400
    numberOfPins: 16
    [0-15] -> gpioManager@[16-31]

gpioC: GPIOPort.STM32_GPIOPort @ sysbus 0x48000800
    numberOfPins: 16
    [0-15] -> gpioManager@[32-47]

gpioManager: GPIOPort.GPIOManager @ sysbus

// Reset and Clock Control (simplified)
rcc: Python.PythonPeripheral @ sysbus 0x40021000
    size: 0x400
    initable: true
    script: '''
if request.isInit:
    # Default clock configuration
    CR = 0x00000063
    CFGR = 0x00000000
elif request.isRead:
    if request.offset == 0x00:  # CR
        request.value = CR
    elif request.offset == 0x08:  # CFGR
        request.value = CFGR
'''

// FDCAN (placeholder)
fdcan1: Python.PythonPeripheral @ sysbus 0x40006400
    size: 0x400
    initable: true
    script: '''
if request.isInit:
    regs = {}
'''

sysbus:
    init:
        Tag <0x40000000, 0x5FFFFFFF> "Peripherals"
