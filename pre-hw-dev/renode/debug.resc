# JEZGRO RTOS Debug Script for Renode
# Starts GDB server on port 3333

# Create machine
mach create "jezgro"

# Load platform description
machine LoadPlatformDescription @renode/stm32g474-minimal.repl

# Load ELF
sysbus LoadELF @build-arm/jezgro_firmware

# Start GDB server on port 3333
machine StartGdbServer 3333

# Show UART output in Renode console
showAnalyzer sysbus.usart1

# Log info
logLevel 1

echo "================================================"
echo "  JEZGRO RTOS Debug Session"
echo "  GDB Server running on localhost:3333"
echo "  Connect with: arm-none-eabi-gdb -ex 'target remote :3333'"
echo "================================================"
echo ""
echo "Commands:"
echo "  start     - Start emulation"
echo "  pause     - Pause emulation"
echo "  quit      - Exit Renode"
echo ""

# Keep Renode running - wait for GDB connection
emulation RunFor "00:00:00.001"
