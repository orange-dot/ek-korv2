{
  "id": "gossip_003",
  "name": "gossip_gap_detection",
  "module": "gossip",
  "function": "ekk_gossip_handle_event",
  "description": "Detect gap in event sequence and request missing events",

  "setup": {
    "init": {"my_id": 2, "k_neighbors": 7},
    "add_neighbors": [1, 3, 4],
    "version_vector": {
      "1": 3,
      "2": 5,
      "3": 2,
      "4": 1
    }
  },

  "input": {
    "gossip_message": {
      "msg_type": "0x60",
      "source_module": 1,
      "event_count": 1,
      "events": [{
        "sequence": 200,
        "timestamp_us": 2000000,
        "event_type": "FieldPublished",
        "origin_id": 1,
        "origin_seq": 7,
        "hop_count": 0,
        "payload": "0xAA 0xBB 0xCC"
      }]
    }
  },

  "expected": {
    "return": "EKK_ERR_NOT_FOUND",
    "event_stored": false,
    "event_buffered": true,
    "gap_detected": {
      "origin_id": 1,
      "expected_seq": 4,
      "received_seq": 7,
      "missing_count": 3
    },
    "request_sent": {
      "msg_type": "0x62",
      "target_module": 1,
      "from_seq": 4,
      "to_seq": 6
    },
    "stats": {
      "gaps_detected": 1
    }
  }
}
